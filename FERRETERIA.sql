CREATE DATABASE FERRETERIAS
GO
USE FERRETERIAS
GO

-- CREAR TABLAS
CREATE TABLE CLIENTES (
	CTEID INT NOT NULL,
	CTENOMBRE VARCHAR(25) NOT NULL,
	CTEAPEPAT VARCHAR(25) NOT NULL,
	CTEAPEMAT VARCHAR(25) NOT NULL,
	CTEDOM VARCHAR (50),
	CTETEL VARCHAR (10),
	CTECEL VARCHAR (10),
	CTERFC VARCHAR (13) NOT NULL,
	CTECURP VARCHAR (18) NOT NULL,
	CTEFECHANACIMIENTO DATE NOT NULL,
	CTESEXO CHAR(1) CHECK (CTESEXO IN ('M', 'F', 'm', 'f')) NOT NULL,
	COLID INT NOT NULL)
GO
CREATE TABLE COLONIAS (
	COLID INT NOT NULL,
	COLNOMBRE VARCHAR (50) NOT NULL,
	COLCP VARCHAR (5) NOT NULL,
	MUNID INT NOT NULL)
GO
CREATE TABLE MUNICIPIOS (
	MUNID INT NOT NULL,
	MUNNOMBRE VARCHAR(50) NOT NULL)
GO
CREATE TABLE FAMILIAS (
	FAMID INT NOT NULL,
	FAMNOMBRE VARCHAR(25) NOT NULL,
	FAMDESCRIPCION VARCHAR(50) NOT NULL)
GO
CREATE TABLE ARTICULOS (
	ARTID INT NOT NULL,
	ARTNOMBRE VARCHAR (25) NOT NULL,
	ARTDESCRIPCION VARCHAR (50) NOT NULL,
	ARTPRECIO DECIMAL (10, 2) NOT NULL,
	FAMID INT NOT NULL)
GO
-- ENTIDAD DEBIL
CREATE TABLE DETALLES (
	DETCANTIDAD INT NOT NULL,
	DETPRECIO DECIMAL (10,2) NOT NULL,
	VTEFOLIO INT NOT NULL,
	ARTID INT NOT NULL)
GO
CREATE TABLE VENTAS (
	VTEFOLIO INT NOT NULL,
	VTEFECHA DATE NOT NULL,
	CTEID INT NOT NULL,
	EMPID INT NOT NULL,
	FERRID INT NOT NULL)
GO
CREATE TABLE EMPLEADOS (
	EMPID INT NOT NULL,
	EMPNOMBRE VARCHAR (25) NOT NULL,
	EMPAPEPAT VARCHAR (25) NOT NULL,
	EMPAPEMAT VARCHAR (25) NOT NULL,
	EMPDOM VARCHAR (50),
	EMPTEL VARCHAR (10),
	EMPCEL VARCHAR (10),
	EMPRFC VARCHAR (13) NOT NULL,
	EMPCURP VARCHAR (18) NOT NULL,
	EMPFECHAINGRESO DATE NOT NULL,
	EMPFECHANACIMIENTO DATE NOT NULL,
	ZONAID INT NOT NULL,
	JEFEID INT NOT NULL
	)
GO
CREATE TABLE ZONAS (
	ZONAID INT NOT NULL,
	ZONANOMBRE VARCHAR(25) NOT NULL)
GO
CREATE TABLE FERRETERIA (
	FERRID INT NOT NULL,
	FERRNOMBRE VARCHAR(25) NOT NULL,
	FERRDOMICILIO VARCHAR (50) NOT NULL,
	FERRTEL VARCHAR (10) NOT NULL)
GO

--AGREGAR CLAVES PRIMARIAS
ALTER TABLE CLIENTES ADD CONSTRAINT PK_CLIENTES PRIMARY KEY (CTEID)
GO
ALTER TABLE COLONIAS ADD CONSTRAINT PK_COLONIAS PRIMARY KEY (COLID)
GO
ALTER TABLE MUNICIPIOS ADD CONSTRAINT  PK_MUNICIPIOS PRIMARY KEY (MUNID)
GO
ALTER TABLE FAMILIAS ADD CONSTRAINT PK_FAMILIAS PRIMARY KEY (FAMID)
GO
ALTER TABLE ARTICULOS ADD CONSTRAINT PK_ARTICULOS PRIMARY KEY (ARTID)
GO
ALTER TABLE VENTAS ADD CONSTRAINT PK_VENTAS PRIMARY KEY (VTEFOLIO)
GO
ALTER TABLE EMPLEADOS ADD CONSTRAINT PK_EMPLEADOS PRIMARY KEY (EMPID)
GO
ALTER TABLE ZONAS ADD CONSTRAINT PK_ZONAS PRIMARY KEY (ZONAID)
GO
ALTER TABLE FERRETERIA ADD CONSTRAINT PK_FERRETERIA PRIMARY KEY (FERRID)
GO

-- AGREGAR CLAVES FORANEAS
ALTER TABLE CLIENTES ADD CONSTRAINT FK_CLIENTES_COL 
FOREIGN KEY (COLID) REFERENCES COLONIAS(COLID)
GO
ALTER TABLE DETALLES ADD CONSTRAINT FK_DETALLES_FOLIO 
FOREIGN KEY (VTEFOLIO) REFERENCES VENTAS(VTEFOLIO)
GO
ALTER TABLE DETALLES ADD CONSTRAINT FK_DETALLES_ART 
FOREIGN KEY (ARTID) REFERENCES ARTICULOS(ARTID)
GO
ALTER TABLE ARTICULOS ADD CONSTRAINT FK_ARTICULOS_FAM
FOREIGN KEY (FAMID) REFERENCES FAMILIAS(FAMID)
GO
ALTER TABLE VENTAS ADD CONSTRAINT FK_VENTAS_CTE
FOREIGN KEY (CTEID) REFERENCES CLIENTES(CTEID)
GO
ALTER TABLE VENTAS ADD CONSTRAINT FK_VENTAS_EMP 
FOREIGN KEY (EMPID) REFERENCES EMPLEADOS(EMPID)
GO
ALTER TABLE VENTAS ADD CONSTRAINT FK_VENTAS_FERR
FOREIGN KEY (FERRID) REFERENCES FERRETERIA(FERRID)
GO
ALTER TABLE EMPLEADOS ADD CONSTRAINT FK_EMPLEADOS_EMP
FOREIGN KEY (JEFEID) REFERENCES EMPLEADOS(EMPID)
GO
ALTER TABLE EMPLEADOS ADD CONSTRAINT FK_EMPLEADOS_ZONAID 
FOREIGN KEY (ZONAID) REFERENCES ZONAS(ZONAID)
GO
ALTER TABLE COLONIAS ADD CONSTRAINT FK_COLONIAS_MUNI 
FOREIGN KEY (MUNID) REFERENCES MUNICIPIOS(MUNID)
GO

--AGREGAR LLAVES UNICAS 
ALTER TABLE CLIENTES ADD CONSTRAINT UC_CLIENTES_RFC UNIQUE(CTERFC)
GO
ALTER TABLE CLIENTES ADD CONSTRAINT UC_CLIENTES_CURP UNIQUE(CTECURP)
GO
ALTER TABLE EMPLEADOS ADD CONSTRAINT UC_EMPLEADOS_RFC UNIQUE(EMPRFC)
GO
ALTER TABLE EMPLEADOS ADD CONSTRAINT UC_EMPLEADOS_CURP UNIQUE(EMPCURP)
GO

--VALORES DEFAULT 
ALTER TABLE CLIENTES ADD CONSTRAINT CC_CLIENTES_DOMICILIO DEFAULT('DOMICILIO DESCONOCIDO') FOR CTEDOM
GO
ALTER TABLE CLIENTES ADD CONSTRAINT CC_CLIENTES_TELEFONO DEFAULT('TELEFONO DESCONOCIDO') FOR CTETEL
GO
ALTER TABLE CLIENTES ADD CONSTRAINT CC_CLIENTES_CELULAR DEFAULT('CELULAR DESCONOCIDO') FOR CTECEL
GO
ALTER TABLE EMPLEADOS ADD CONSTRAINT CC_EMPLEADOS_DOMICILIO DEFAULT('DOMICILIO DESCONOCIDO') FOR EMPDOM
GO
ALTER TABLE EMPLEADOS ADD CONSTRAINT CC_EMPLEADOS_TELEFONO DEFAULT('TELEFONO DESCONOCIDO') FOR EMPTEL
GO
ALTER TABLE EMPLEADOS ADD CONSTRAINT CC_EMPLEADOS_CELULAR DEFAULT('CELULAR DESCONOCIDO') FOR EMPCEL
GO
ALTER TABLE FERRETERIA ADD CONSTRAINT CC_FERRETERIA_DOMICILIO DEFAULT('DOMICILIO DESCONOCIDO') FOR FERRDOMICILIO
GO
ALTER TABLE FERRETERIA ADD CONSTRAINT CC_FERRETERIA_TELEFONO DEFAULT('TELEFONO DESCONOCIDO') FOR FERRTEL
GO

--COMPROBACIONES
ALTER TABLE CLIENTES ADD CONSTRAINT CC_CLIENTES_RFC_CURP CHECK(CTERFC<>CTECURP)
GO
ALTER TABLE CLIENTES ADD CHECK (LEN(CTERFC) IN (12, 13))
GO
ALTER TABLE CLIENTES ADD CHECK (LEN(CTECURP) = 18)
GO
ALTER TABLE CLIENTES ADD CHECK (LEN(CTETEL) = 10)
GO
ALTER TABLE CLIENTES ADD CHECK (LEN(CTECEL) = 10)
GO
ALTER TABLE EMPLEADOS ADD CONSTRAINT CC_EMPLEADOS_RFC_CURP CHECK(EMPRFC<>EMPCURP)
GO
ALTER TABLE EMPLEADOS ADD CHECK (LEN(EMPRFC) IN (12, 13))
GO
ALTER TABLE EMPLEADOS ADD CHECK (LEN(EMPCURP) = 18)
GO
ALTER TABLE EMPLEADOS ADD CHECK (LEN(EMPTEL) = 10)
GO
ALTER TABLE EMPLEADOS ADD CHECK (LEN(EMPCEL) = 10)
GO
ALTER TABLE FERRETERIA ADD CHECK (LEN(FERRTEL) = 10)
GO

--AGREGAR DATOS A LAS TABLAS
INSERT INTO MUNICIPIOS (MUNID, MUNNOMBRE)
VALUES
  (1, 'Sinaloa'), 
  (2, 'Veracruz'),
  (3, 'Jalisco'),
  (4, 'Guerrero'),
  (5, 'Oaxaca')
GO
INSERT INTO COLONIAS (COLID, COLNOMBRE, COLCP, MUNID)
VALUES
  (1, 'Centro', '06000', 1),
  (2, 'Cuauhtemoc', '06500', 2),
  (3, 'Del Valle', '03100', 3),
  (4, 'Narvarte', '03020', 4),
  (5, 'Juárez', '06600', 5)
GO

INSERT INTO CLIENTES (CTEID, CTENOMBRE, CTEAPEPAT, CTEAPEMAT, CTEDOM, CTETEL, CTECEL, CTERFC, CTECURP, CTEFECHANACIMIENTO, CTESEXO, COLID) 
VALUES 
  (1, 'Juan', 'Perez', 'Gonzalez', '', '6674332242', '5566778833', 'PEJG770215MR4', 'PEJG770215HDFTRR01', '1977-02-15', 'M', 1),
  
  (2, 'Maria', 'Garcia', 'Rodriguez', 'Av Siempre Viva 781', '6674499662', '5566448812', 'GARM850622RT5', 'GARM850622MDFRMD04', '1985-06-22', 'F', 3),

  (3, 'Pedro', 'Lopez', 'Martinez', 'Cerro Grande 234', '6676677443', '5544332265', 'LOPM701213LP2', 'LOPM701213HDFLRS09', '1970-12-13', 'M', 2),  

  (4, 'Rosa', 'Fernandez', 'Perez', 'Prolongacion Reforma 890', '6676321991', '5588996634', 'FERP850311RT6', 'FERP850311MDFRRS07', '1985-03-11', 'F', 1),

  (5, 'Eduardo', 'Gonzalez', 'Sanchez', 'Privada Sol 456', '6672288445', '5544332253', 'GOSA791225SD4', 'GOSA791225HDFZEE06', '1979-12-25', 'M', 5)
  GO
  
  INSERT INTO FERRETERIA (FERRID, FERRNOMBRE, FERRDOMICILIO, FERRTEL)
  VALUES
	(1, 'Ferretería Abista', 'Calle 123, Ciudad Omega', '1234567890'),
    (2, 'Ferretería Bulca', 'Avenida Principal, Ciudad Y', '9876543210'),
    (3, 'Ferretería Carpi', 'Carretera 456, Ciudad Z', '5551234567'),
    (4, 'Ferretería Dico', 'Calle 789, Ciudad W', '1112223333'),
    (5, 'Ferretería Erpa', 'Avenida 567, Ciudad V', '4445556666')
GO

INSERT INTO FAMILIAS (FAMID, FAMNOMBRE, FAMDESCRIPCION)
VALUES 
	(1, 'Electrodomésticos', 'Productos electrónicos para el hogar'),
    (2, 'Herramientas', 'Herramientas para bricolaje y construcción'),
    (3, 'Jardinería', 'Suministros de jardinería y paisajismo'),
    (4, 'Muebles', 'Muebles para el hogar y la oficina'),
    (5, 'Iluminación', 'Productos de iluminación y lámparas')
GO

INSERT INTO ARTICULOS (ARTID, ARTNOMBRE, ARTPRECIO, ARTDESCRIPCION, FAMID)
VALUES 
	(1, 'Taladro eléctrico', 678.99, 'Taladro de 550 W con accesorios', 2),
    (2, 'Lámpara de techo', 49.99, 'Lámpara colgante moderna', 5),
    (3, 'Cortacésped a gasolina', 5234.99, 'Cortacésped de 21 pulgadas', 3),
    (4, 'Sofá seccional', 3456.99, 'Sofá de cuero con chaise longue', 4),
    (5, 'Cafetera programable', 423.99, 'Cafetera de 12 tazas con temporizador', 1)
GO

INSERT INTO ZONAS (ZONAID, ZONANOMBRE)
VALUES
	(1, 'Zona Norte'),
    (2, 'Zona Sur'),
    (3, 'Zona Este'),
    (4, 'Zona Oeste'),
    (5, 'Zona Central')
GO

-- OPCIONAL
ALTER TABLE EMPLEADOS
ALTER COLUMN JEFEID INT NULL;

-- INSERTAR JEFE
INSERT INTO EMPLEADOS (EMPID,EMPNOMBRE, EMPAPEPAT, EMPAPEMAT, EMPDOM, EMPTEL, EMPCEL, EMPRFC, EMPCURP, EMPFECHAINGRESO, EMPFECHANACIMIENTO, ZONAID, JEFEID)
VALUES
	(1, 'Juan', 'González', 'López', 'Calle 123, Ciudad X', '1234567890', '9876543210', 'ABC123456XYZ', 'GLPJ890101HDFLNS09', '2023-01-15', '1989-01-01', 1 , 1)
GO

INSERT INTO EMPLEADOS (EMPID,EMPNOMBRE, EMPAPEPAT, EMPAPEMAT, EMPDOM, EMPTEL, EMPCEL, EMPRFC, EMPCURP, EMPFECHAINGRESO, EMPFECHANACIMIENTO, ZONAID, JEFEID)
VALUES
    (2, 'María', 'Martínez', 'Rodríguez', 'Avenida Principal, Ciudad Y', '5551234567', '2223334444', 'DEF987654ABC', 'MRPR750202MCMRNS03', '2022-12-10', '1975-02-02', 2, NULL),
    (3, 'Carlos', 'Pérez', 'Sánchez', 'Calle 456, Ciudad Z', '1112223333', '4445556666', 'GHI456789XYZ', 'CPSS880515HDFRRR01', '2021-11-20', '1988-05-15', 3, NULL),
    (4, 'Ana', 'López', 'Gómez', 'Calle 789, Ciudad W', '9998887777', '3332221111', 'JKL987654PQR', 'ALGG910630MDFPNA04', '2023-02-05', '1991-06-30', 4, NULL),
    (5, 'Pedro', 'Ramírez', 'Hernández', 'Avenida 567, Ciudad V', '3467892567', '1112223333', 'MNO123456ABC', 'PRHH960710HDFRRR06', '2023-03-15', '1996-07-10', 5, NULL)
GO

INSERT INTO VENTAS (VTEFOLIO, VTEFECHA, CTEID, EMPID, FERRID)
VALUES
  (3, '2023-03-10', 3, 3, 3),
  (1, '2023-01-15', 1, 1, 1),
  (4, '2023-04-05', 4, 4, 4),
  (5, '2023-05-20', 5, 5, 5),
  (2, '2023-02-28', 2, 2, 2);
GO
